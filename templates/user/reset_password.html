{% extends 'include/homepage.html' %}
{% load static %}
{% block content %}

	{% include 'include/header.html' %}
	{% include 'include/mobile_header.html' %}
	<div class="main-content main-content-login">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="breadcrumb-trail breadcrumbs">
						<ul class="trail-items breadcrumb">
							<li class="trail-item trail-begin">
								<a href="{% url 'index' %}">Главная страница</a>
							</li>
							<li class="trail-item trail-end active">
								Новый пароль 
							</li>
						</ul>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="content-area col-lg-12 col-md-12 col-sm-12 col-xs-12">
					<div class="site-main">
						<h3 class="custom_blog_title">
							Новый пароль 
						</h3>
						<div class="customer_login">
							<div class="row">
								<div class="col-lg-6 col-md-6 col-sm-12">
									<div class="login-item">
										<div class="login-item">
											<form id="reset-password-form" method="POST" class="login">
												{% csrf_token %}
												<p class="form-row form-row-wide">
													<label class="text">Код, который был отправлен на ваш email</label>
													<input title="password" name="code" type="text" class="input-text">
													<div id="codeError" class="error-message"></div>
												</p>
												<p class="form-row form-row-wide">
													<label class="text">Новый пароль</label>
													<div class="password-container">
														<input id="password" name="new_password" type="password" class="input-text">
														<span id="togglePassword" class="toggle-password"></span>
													</div>
													<button type="button" class="toggle-password" onclick="togglePassword('new_password')">
														<i class="fa fa-eye"></i>
													</button>
													<div id="passwordError" class="error-message"></div>
												</p>
												<p class="form-row form-row-wide">
													<label class="text">Подтвердите пароль</label>
													<div class="password-container">
														<input id="confirm_password" name="confirm_password" type="password" class="input-text">
														<span id="toggleConfirmPassword" class="toggle-password"></span>
													</div>
													<button type="button" class="toggle-password" onclick="togglePassword('confirm_password')">
														<i class="fa fa-eye"></i>
													</button>
													<div id="confirmPasswordError" class="error-message"></div>
												</p>
												<p class="form-row">
													<input type="submit" name="reset_password" class="button-submit" value="Сохранить" style="border-radius: 100px;">
												</p>
											</form>
										
											<style>
												.password-container {
													position: relative;
													display: flex;
													align-items: center;
												}
												.input-text {
													flex: 1;
													padding-right: 2.5em; /* Увеличиваем пространство для кнопки */
												}
												.toggle-password {
													position: absolute;
													right: 0.5em;
													border: none;
													background: none;
													transform: translateY(-150%);
													cursor: pointer;
													color: #c09578; /* Используйте основной цвет сайта */
													font-size: 1.2em;
													padding: 0;
													margin-right: 60px;
													margin-bottom: 100px;
												}
												.toggle-password:hover {
													color: #c09578; /* Цвет при наведении */
												}
											</style>
										
											<script>
											document.addEventListener('DOMContentLoaded', function () {
												// Функция для переключения видимости пароля
												function togglePasswordVisibility(passwordFieldId, toggleButton) {
													const passwordField = document.getElementById(passwordFieldId);
													const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
													passwordField.setAttribute('type', type);
											
													// Изменение иконки в зависимости от типа поля
													toggleButton.querySelector('i').classList.toggle('fa-eye');
													toggleButton.querySelector('i').classList.toggle('fa-eye-slash');
												}
											
												// Получаем элементы кнопок и поля ввода паролей
												const togglePasswordButton = document.querySelector('button[onclick="togglePassword(\'new_password\')"]');
												const toggleConfirmPasswordButton = document.querySelector('button[onclick="togglePassword(\'confirm_password\')"]');
											
												// Привязываем событие клика к кнопке для нового пароля
												togglePasswordButton.addEventListener('click', function () {
													togglePasswordVisibility('password', togglePasswordButton);
												});
											
												// Привязываем событие клика к кнопке для подтверждения пароля
												toggleConfirmPasswordButton.addEventListener('click', function () {
													togglePasswordVisibility('confirm_password', toggleConfirmPasswordButton);
												});
											
												// Обработчик формы
												const form = document.getElementById('reset-password-form');
												form.addEventListener('submit', function (event) {
													event.preventDefault(); // Предотвращаем отправку формы
											
													// Очищаем предыдущие ошибки
													document.getElementById('codeError').innerText = '';
													document.getElementById('passwordError').innerText = '';
													document.getElementById('confirmPasswordError').innerText = '';
											
													const formData = new FormData(form);
													const csrfToken = formData.get('csrfmiddlewaretoken');
											
													fetch(form.action, {
														method: 'POST',
														headers: {
															'X-CSRFToken': csrfToken,
														},
														body: formData
													})
													.then(response => response.json()) // Обработка JSON-ответа
													.then(data => {
														if (data.success) {
															window.location.href = data.redirect_url || '/'; // Перенаправление после успешного изменения пароля
														} else {
															// Распределяем ошибки по полям
															if (data.error_code) {
																document.getElementById('codeError').innerText = data.error_code; // Ошибка для поля с кодом
															}
															if (data.error_password) {
																document.getElementById('passwordError').innerText = data.error_password; // Ошибка для поля с паролем
															}
															if (data.error_confirm_password) {
																document.getElementById('confirmPasswordError').innerText = data.error_confirm_password; // Ошибка для поля подтверждения пароля
															}
														}
													})
												});
											});
											</script>
										</div>
										
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	{% include 'include/footer.html' %}
	{% include 'include/mobile_footer.html' %}
{% endblock %}